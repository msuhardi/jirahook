#!/usr/bin/env node
  // => [{ "name": "john", "dinner": "sushi" }]

/**
 * Module dependencies.
 */

var program = require('commander');
var exec = require('child_process').exec;

var run = function(cmd){
  var child = exec(cmd, function (error, stdout, stderr) {
    if (stderr !== null) {
      console.log('' + stderr);
    }
    if (stdout !== null) {
      console.log('' + stdout);
    }
    if (error !== null) {
      console.log('' + error);
    }
  });
};

program
  .version('0.1.3')
  .option('n, --new [name]', 'Create a new session with name: [name]')
  .option('r, --rename [name]', 'Rename current session with name: [name]')
  .option('rm, --rm [name]', 'Delete the session with name: [name]')
  .option('s, --switch [name]', 'Switch to the session with name: [name]')
  .option('ls, --ls', 'List all sessions')
  .parse(process.argv);



if (program.new) {
  run('tmux new -d -s ' + program.new);
  run('tmux switch-client -t ' + program.new);
}

if (program.rename) {
  run('tmux rename-session ' + program.rename);
}

if (program.rm) {
  run('tmux kill-session -t ' + program.rm);
}

if (program.switch) {
  run('tmux switch-client -t ' + program.switch);
}

if (program.ls) {
  run('tmux ls');
}

var count = 0;


// If parameter is missing or not supported, display help
program.options.filter(function (option) {
  if(!(option.short == process.argv[2]))
    count++
});

if(count == program.options.length)
  program.help();
